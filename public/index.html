<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Space</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans antialiased overflow-hidden">
    <div id="app-container" class="w-full h-screen relative">
        <div id="chat-background" class="absolute inset-0 transition-all duration-500"></div>
        
        <div id="join-code-page" class="page active z-10 flex-col items-center justify-center p-4">
             <div class="w-full max-w-sm bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg p-8 rounded-xl shadow-lg text-center">
                <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-4">Chat Space</h1>
                <p class="text-gray-500 dark:text-gray-300 mb-6">Enter the join code to continue.</p>
                <div id="join-error" class="text-red-500 mb-4 h-5 font-semibold"></div>
                <form id="join-code-form" class="space-y-4">
                    <input type="text" id="join-code-input" placeholder="Join Code" class="w-full text-center tracking-widest font-bold text-lg px-4 py-3 bg-gray-100 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition shadow-md">Enter</button>
                </form>
            </div>
        </div>
        <div id="login-page" class="page hidden z-10 flex-col items-center justify-center p-4">
             <div class="w-full max-w-sm bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg p-8 rounded-xl shadow-lg">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Login or Signup</h1>
                    <p class="text-gray-500 dark:text-gray-300 mt-2">Create an account or sign in.</p>
                </div>
                <div id="login-error" class="text-red-500 text-center mb-4 h-5 font-semibold"></div>
                <form id="login-form" class="space-y-6">
                    <div class="relative"><i class="ri-user-line ri-lg absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" id="login-username" placeholder="Username" class="w-full px-4 py-3 pl-12 bg-gray-100 dark:bg-gray-700 dark:text-white rounded-lg" required></div>
                    <div class="relative"><i class="ri-lock-password-line ri-lg absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="password" id="login-password" placeholder="Password" class="w-full px-4 py-3 pl-12 bg-gray-100 dark:bg-gray-700 dark:text-white rounded-lg" required></div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition shadow-md">Login / Signup</button>
                </form>
            </div>
        </div>

        <div id="chat-page" class="page hidden h-full z-10">
            <aside id="navigation-sidebar" class="w-64 bg-gray-200/60 dark:bg-gray-800/60 backdrop-blur-md p-4 flex flex-col">
                <div class="flex-shrink-0">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-lg font-bold dark:text-white px-3">Branches</h2><button id="add-channel-btn" class="sidebar-btn"><i class="ri-add-line"></i></button></div>
                    <div id="channels-list" class="space-y-1 overflow-y-auto max-h-48"></div>
                </div>
                <div class="flex-grow mt-4 pt-4 border-t border-gray-300/50 dark:border-gray-700/50 overflow-y-auto">
                     <h2 class="text-lg font-bold dark:text-white px-3 mb-2">Direct Messages</h2>
                     <div id="dm-list" class="space-y-1"></div>
                </div>
                <div class="mt-auto flex-shrink-0 space-y-2">
                    <button id="user-database-btn" class="sidebar-btn-full"><i class="ri-group-line"></i><span>Users</span></button>
                    <button id="settings-btn" class="sidebar-btn-full"><i class="ri-settings-3-line"></i><span>Settings</span></button>
                    <div class="relative">
                        <select id="status-selector" class="w-full p-2 rounded-lg bg-gray-300 dark:bg-gray-700 dark:text-white">
                            <option value="online">Online</option>
                            <option value="busy">Busy</option>
                            <option value="invisible" id="invisible-option" class="hidden">Invisible</option>
                        </select>
                    </div>
                </div>
            </aside>
            
            <main id="main-chat-area" class="flex-grow flex flex-col bg-white/40 dark:bg-gray-900/40 backdrop-blur-md">
                <header class="p-4 border-b border-gray-300/50 dark:border-gray-700/50 flex items-center justify-between">
                    <h1 id="channel-title" class="text-2xl font-bold dark:text-white"># general</h1>
                </header>
                
                <div id="chat-status-banner" class="hidden p-2 text-center bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-100 font-semibold">
                    Chat is currently paused.
                </div>

                <div id="chat-window" class="flex-grow p-4 overflow-y-auto"></div>
                <footer class="p-4 border-t border-gray-300/50 dark:border-gray-700/50">
                    <div id="game-container" class="hidden mb-2"></div>
                    <div id="typing-indicator" class="h-5 text-sm italic text-gray-600 dark:text-gray-400"></div>
                    <div id="reply-preview" class="hidden items-center justify-between text-sm p-2 mb-2 bg-gray-200 dark:bg-gray-700 rounded-md">
                        <div class="truncate"><span class="text-xs text-gray-600 dark:text-gray-400">Replying to <strong id="reply-author"></strong></span><p id="reply-preview-text" class="text-gray-800 dark:text-gray-200"></p></div>
                        <button id="cancel-reply-btn" class="p-1 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full"><i class="ri-close-line"></i></button>
                    </div>
                    <form id="message-form" class="flex items-center gap-2">
                        <button type="button" id="giphy-btn" class="p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition"><i class="ri-gif-line ri-lg"></i></button>
                        <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off" class="flex-grow px-4 py-3 bg-white/80 dark:bg-gray-800/80 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-white">
                        <button type="submit" class="bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition shadow-md"><i class="ri-send-plane-2-fill ri-lg"></i></button>
                    </form>
                </footer>
            </main>

            <aside id="user-list-sidebar" class="w-60 bg-gray-200/60 dark:bg-gray-800/60 backdrop-blur-md p-4 overflow-y-auto">
                <h2 class="text-lg font-bold dark:text-white mb-4">Online Users</h2>
                <div id="user-list-container"></div>
            </aside>
        </div>
    </div>
    
    <div id="terms-modal" class="modal-container hidden">
        <div class="modal-content max-w-lg">
            <h2 class="text-2xl font-bold mb-4 dark:text-white">Terms of Service & Community Guidelines</h2>
            <div class="prose prose-sm dark:prose-invert max-w-none max-h-80 overflow-y-auto pr-4">
                <p>Welcome to Chat Space. By proceeding, you acknowledge and consent to the following stipulations:</p>
                <p><strong>Assumption of Responsibility:</strong> You hereby affirm that all actions, communications, and content you generate or transmit within this digital environment are solely your own. You accept full and unequivocal liability for any and all consequences, legal or otherwise, that may arise from your activities.</p>
                <p><strong>Consent to Monitoring:</strong> You understand and agree that your activities within this service may be subject to observation and logging by authorized administrative personnel for the purposes of maintaining community standards, ensuring operational integrity, and investigating potential violations of these terms.</p>
                <p><strong>Code of Conduct:</strong> You commit to fostering a respectful and constructive atmosphere. Harassment, dissemination of malicious content, and any form of illicit activity are expressly forbidden and may result in immediate and permanent revocation of access without prior notice.</p>
                <p>Your continued use of this service constitutes a binding agreement to these terms.</p>
            </div>
            <div class="mt-6 flex justify-end">
                <button id="agree-terms-btn" class="btn-primary">I Understand and Agree</button>
            </div>
        </div>
    </div>

    <div id="tutorial-modal" class="modal-container hidden">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center">
                <h2 id="tutorial-title" class="text-2xl font-bold dark:text-white">Welcome to Chat Space!</h2>
                <button id="close-tutorial-btn" class="modal-close-btn"><i class="ri-close-line"></i></button>
            </div>
            <div id="tutorial-content" class="mt-4 space-y-4"></div>
            <div class="mt-6 flex justify-between items-center">
                <button id="prev-tutorial-btn" class="btn-secondary">Previous</button>
                <span id="tutorial-pagination"></span>
                <button id="next-tutorial-btn" class="btn-primary">Next</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal-container hidden">
        <div class="modal-content max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-white">Settings</h2>
                <button id="close-settings-btn" class="modal-close-btn"><i class="ri-close-line"></i></button>
            </div>
            <div id="owner-settings-tabs" class="mb-4 border-b border-gray-200 dark:border-gray-700">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button class="setting-tab active" data-tab="profile">Profile</button>
                    <button class="setting-tab" data-tab="preferences">Preferences</button>
                    <button class="setting-tab owner-only" data-tab="user-management">User Management</button>
                    <button class="setting-tab owner-only" data-tab="permissions">Permissions</button>
                    <button class="setting-tab owner-only" data-tab="audit-log">Audit Log</button>
                </nav>
            </div>
            <div id="profile-tab-content" class="setting-tab-content">...</div>
            <div id="preferences-tab-content" class="setting-tab-content hidden">...</div>
            <div id="user-management-tab-content" class="setting-tab-content hidden owner-only">
                <input type="text" id="user-management-search" placeholder="Search users..." class="w-full p-2 mb-4 rounded-lg bg-gray-100 dark:bg-gray-700">
                <div id="user-management-list" class="max-h-96 overflow-y-auto"></div>
            </div>
            <div id="permissions-tab-content" class="setting-tab-content hidden owner-only">
                <div id="permissions-list" class="space-y-4"></div>
            </div>
            <div id="audit-log-tab-content" class="setting-tab-content hidden owner-only">
                <div id="audit-log-list" class="max-h-96 overflow-y-auto space-y-2"></div>
            </div>
        </div>
    </div>

    <div id="user-database-modal" class="modal-container hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-white">User Database</h2>
                <button id="close-user-db-btn" class="modal-close-btn"><i class="ri-close-line"></i></button>
            </div>
            <input type="text" id="user-db-search" placeholder="Search users..." class="w-full p-2 mb-4 rounded-lg bg-gray-100 dark:bg-gray-700">
            <div id="user-db-list" class="max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <div id="user-edit-modal" class="modal-container hidden">
        <div class="modal-content max-w-lg">
            <h3 id="user-edit-title" class="text-xl font-bold mb-4"></h3>
            <div class="space-y-4">
                <div><label>Nickname</label><input id="edit-nickname" type="text" class="modal-input"></div>
                <div><label>Role</label><select id="edit-role" class="modal-input"></select></div>
                <div class="flex items-center justify-between"><label>Allow Copy/Paste</label><input id="edit-can-copy" type="checkbox"></div>
                <hr>
                <div class="flex gap-2">
                    <button id="kick-btn" class="btn-warning">Kick</button>
                    <button id="ban-btn" class="btn-danger">Ban</button>
                    <button id="silent-ban-btn" class="btn-danger-secondary">Silent Ban</button>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-2">
                <button id="cancel-edit-btn" class="btn-secondary">Cancel</button>
                <button id="save-edit-btn" class="btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="user-profile-modal" class="modal-container hidden">
        <div class="modal-content max-w-md">
            <button id="close-profile-btn" class="modal-close-btn absolute top-4 right-4"><i class="ri-close-line"></i></button>
            <div id="profile-content" class="text-center"></div>
        </div>
    </div>

    <div id="mute-modal" class="modal-container hidden">
        <div class="modal-content max-w-sm">
            <h3 id="mute-title" class="text-xl font-bold mb-4"></h3>
            <div class="space-y-2">
                <button class="btn-secondary w-full" data-duration="5">Mute for 5 minutes</button>
                <button class="btn-secondary w-full" data-duration="60">Mute for 1 hour</button>
                <button class="btn-secondary w-full" data-duration="1440">Mute for 1 day</button>
            </div>
        </div>
    </div>

    <div id="user-context-menu" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-md shadow-lg p-2 text-sm w-40">
        <button data-action="profile" class="context-menu-btn"><i class="ri-user-line mr-2"></i>View Profile</button>
        <button data-action="dm" class="context-menu-btn"><i class="ri-message-2-line mr-2"></i>Message</button>
        <button data-action="friend" class="context-menu-btn"><i class="ri-user-add-line mr-2"></i>Add Friend</button>
        <button data-action="unfriend" class="context-menu-btn"><i class="ri-user-unfollow-line mr-2"></i>Remove Friend</button>
        <button data-action="block" class="context-menu-btn text-red-500"><i class="ri-forbid-2-line mr-2"></i>Block</button>
        <button data-action="unblock" class="context-menu-btn text-green-500"><i class="ri-check-line mr-2"></i>Unblock</button>
    </div>

    <div id="reaction-popup" class="hidden absolute z-20 bg-white dark:bg-gray-700 rounded-full shadow-lg p-1 flex gap-1 transition-transform duration-150 ease-out"></div>
    <div id="emoji-picker" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-md shadow-lg p-2 grid grid-cols-6 gap-1"></div>
    <div id="giphy-modal" class="modal-container hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-white">Search for a GIF</h2>
                <button id="close-giphy-btn" class="modal-close-btn"><i class="ri-close-line"></i></button>
            </div>
            <input type="text" id="giphy-search-input" placeholder="Search Giphy..." class="w-full p-2 mb-4 rounded-lg bg-gray-100 dark:bg-gray-700">
            <div id="giphy-results-grid" class="max-h-96 overflow-y-auto grid grid-cols-2 md:grid-cols-3 gap-2"></div>
        </div>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
