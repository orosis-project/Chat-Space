<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Space</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-container">
        <!-- Join Code Screen -->
        <div id="join-screen" class="screen active">
            <div class="card fade-in">
                <img src="https://placehold.co/100x100/A0A0A0/FFFFFF?text=CS" alt="Chat Space Logo" class="logo">
                <h1 class="title">Chat Space</h1>
                <p class="subtitle">Enter the secret join code to continue.</p>
                <form id="join-form">
                    <input type="password" id="join-code" placeholder="Enter Join Code" required>
                    <button type="submit" class="btn primary">Enter</button>
                </form>
                <div id="join-message" class="message"></div>
            </div>
        </div>

        <!-- Login/Register Screen -->
        <div id="auth-screen" class="screen">
            <div class="card fade-in">
                <h1 class="title">Welcome</h1>
                <p class="subtitle" id="auth-subtitle">Login to your account.</p>
                <form id="login-form">
                    <input type="text" id="login-username" placeholder="Username" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <input type="hidden" id="device-id">
                    <button type="submit" class="btn primary">Login</button>
                </form>
                <div id="auth-message" class="message"></div>
                <div id="auth-loading" class="loading-spinner hidden"></div>
                <div class="auth-options">
                    <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
                </div>
            </div>
        </div>

        <!-- 2FA Verification Screen -->
        <div id="2fa-screen" class="screen">
            <div class="card fade-in">
                <h1 class="title">Two-Factor Authentication</h1>
                <p class="subtitle">Enter the 6-digit code from your authenticator app.</p>
                <form id="2fa-form">
                    <input type="text" id="2fa-token" placeholder="6-digit code" required>
                    <button type="submit" class="btn primary">Verify</button>
                </form>
                <div id="2fa-message" class="message"></div>
            </div>
        </div>

        <!-- Face ID Verification Screen -->
        <div id="faceid-screen" class="screen">
            <div class="card fade-in">
                <h1 class="title">Face ID Verification</h1>
                <p class="subtitle">Please look at the camera to verify your identity.</p>
                <div class="face-id-container">
                    <video id="webcam" autoplay playsinline></video>
                    <canvas id="face-canvas" class="hidden"></canvas>
                </div>
                <div id="faceid-message" class="message"></div>
                <button id="faceid-capture-btn" class="btn primary">Capture Face</button>
                <button id="faceid-login-btn" class="btn primary hidden">Login</button>
            </div>
        </div>

        <!-- Buddy System Screen -->
        <div id="buddy-screen" class="screen">
            <div class="card fade-in">
                <h1 class="title">Buddy System Verification</h1>
                <p class="subtitle">An approval request has been sent to your buddy.</p>
                <p>Please wait for them to approve your login. This page will update automatically once approved.</p>
            </div>
        </div>

        <!-- Main Chat Screen -->
        <div id="chat-screen" class="screen">
            <div class="chat-container fade-in">
                <!-- User list -->
                <div class="sidebar" id="user-sidebar">
                    <div class="sidebar-header">
                        <h3 class="sidebar-title">Online Users</h3>
                        <button id="settings-btn" class="sidebar-btn"><i class="fa-solid fa-gear"></i></button>
                    </div>
                    <ul id="user-list"></ul>
                </div>

                <!-- Chat area -->
                <div class="chat-main">
                    <div id="messages-container" class="messages-container"></div>

                    <!-- Chat input and controls -->
                    <div class="chat-input-area">
                        <div class="chat-buttons">
                            <button id="poll-btn" class="chat-btn"><i class="fa-solid fa-square-poll-vertical"></i></button>
                            <button id="gif-btn" class="chat-btn"><i class="fa-solid fa-gift"></i></button>
                        </div>
                        <input type="text" id="message-input" placeholder="Type a message or command...">
                        <button id="send-btn" class="btn send-btn">Send</button>
                    </div>

                    <!-- GIF Keyboard -->
                    <div id="gif-keyboard" class="gif-keyboard hidden">
                        <div class="gif-search-container">
                            <input type="text" id="gif-search-input" placeholder="Search Giphy...">
                        </div>
                        <div id="gif-results" class="gif-results"></div>
                    </div>

                    <!-- Poll Modal -->
                    <div id="poll-modal" class="modal hidden">
                        <div class="modal-content">
                            <h3 class="modal-title">Create a New Poll</h3>
                            <form id="poll-form">
                                <input type="text" id="poll-question" placeholder="Poll question..." required>
                                <div id="poll-options-container">
                                    <input type="text" class="poll-option" placeholder="Option 1" required>
                                    <input type="text" class="poll-option" placeholder="Option 2" required>
                                </div>
                                <button type="button" id="add-option-btn" class="btn secondary">Add Option</button>
                                <button type="submit" class="btn primary">Create Poll</button>
                            </form>
                            <button id="close-poll-modal" class="close-btn">&times;</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="screen">
            <div class="admin-container fade-in">
                <div class="sidebar admin-sidebar">
                    <h3 class="sidebar-title">Admin Controls</h3>
                    <ul class="admin-menu">
                        <li data-panel="logs" class="active">Security Logs</li>
                        <li data-panel="users">User Management</li>
                        <li data-panel="ip">IP Controls</li>
                        <li data-panel="lockdown">Emergency Lockdown</li>
                        <li data-panel="settings">Settings</li>
                    </ul>
                    <button id="logout-btn" class="btn logout-btn">Logout</button>
                </div>
                <div class="admin-main">
                    <!-- Logs Panel -->
                    <div id="logs-panel" class="admin-panel active">
                        <h2 class="admin-panel-title">Security & Event Logs</h2>
                        <div id="logs-container" class="admin-log-list"></div>
                    </div>

                    <!-- User Management Panel -->
                    <div id="users-panel" class="admin-panel">
                        <h2 class="admin-panel-title">User Management</h2>
                        <div id="user-management-container" class="admin-user-list"></div>
                    </div>

                    <!-- IP Controls Panel -->
                    <div id="ip-panel" class="admin-panel">
                        <h2 class="admin-panel-title">IP Address Controls</h2>
                        <form id="ip-control-form">
                            <input type="text" id="ip-address-input" placeholder="Enter IP Address">
                            <select id="ip-rule-select">
                                <option value="allow">Allow</option>
                                <option value="block">Block</option>
                            </select>
                            <button type="submit" class="btn primary">Add Rule</button>
                        </form>
                        <div id="ip-list-container">
                            <h4>Allowed IPs</h4>
                            <ul id="allowed-ips"></ul>
                            <h4>Blocked IPs</h4>
                            <ul id="blocked-ips"></ul>
                        </div>
                    </div>

                    <!-- Emergency Lockdown Panel -->
                    <div id="lockdown-panel" class="admin-panel">
                        <h2 class="admin-panel-title">Emergency Lockdown System</h2>
                        <p>Current Status: <span id="lockdown-status">OFF</span></p>
                        <form id="lockdown-form">
                            <select id="lockdown-mode">
                                <option value="none">Off</option>
                                <option value="block_all">Block All Users</option>
                                <option value="block_anon">Block Non-Logged-In Users</option>
                            </select>
                            <button type="submit" class="btn primary">Apply Lockdown</button>
                        </form>
                    </div>

                    <!-- Settings Panel -->
                    <div id="settings-panel" class="admin-panel">
                        <h2 class="admin-panel-title">Application Settings</h2>
                        <div class="setting-item">
                            <label for="account-approval-toggle">Require Account Approval</label>
                            <input type="checkbox" id="account-approval-toggle">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="message-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="modal-title">Message</h3>
            <p id="modal-message-text"></p>
            <button class="btn primary close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- 2FA Setup Modal -->
    <div id="2fa-setup-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="modal-title">Set up Two-Factor Authentication</h3>
            <p id="2fa-setup-text">Scan the QR code below with your authenticator app (like Google Authenticator or Authy).</p>
            <div id="2fa-qr-container">
                <canvas id="2fa-qr-canvas"></canvas>
            </div>
            <form id="2fa-setup-form">
                <input type="text" id="2fa-setup-token" placeholder="Enter 6-digit code to verify" required>
                <button type="submit" class="btn primary">Verify & Enable 2FA</button>
            </form>
            <button id="close-2fa-setup-modal" class="close-btn">&times;</button>
        </div>
    </div>


    <!-- Library Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fingerprintjs@3/dist/fp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/speakeasy/2.0.0/speakeasy.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>

    <!-- Main Application Script -->
    <script src="main.js"></script>
</body>
</html>
